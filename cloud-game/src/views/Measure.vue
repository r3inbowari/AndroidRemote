<template>
  <div class="measure">
    <div class="measure-content">
      <div v-for="(item, index) in MeasureItems.dat">
        <div @click="onOpen(index)" class="measure-item">
          <div class="item-title">{{ item.title }}</div>
        </div>
        <div class="dvi"></div>
      </div>
    </div>
  </div>

  <!-- Êü•Áúã‰∏ªÈ°µÊ®™ÂπÖ -->
  <el-dialog
    :custom-class="customClass"
    title="Ê®™ÂπÖÂàóË°®"
    v-model="dialogBannerTableVisible"
  >
    <el-table :data="bannerData.dat">
      <el-table-column property="title" label="ÂêçÁß∞" width="150">
      </el-table-column>
      <el-table-column property="_id" label="ID ËØÜÂà´Âè∑" width="150">
      </el-table-column>
      <el-table-column property="alias" label="Âà´Âêç" width="150">
      </el-table-column>
      <el-table-column property="icon" label="App ÂõæÊ†áËµÑÊ∫ê" width="150">
      </el-table-column>
      <el-table-column property="cover" label="App Ê®™ÂπÖËµÑÊ∫ê" width="150">
      </el-table-column>
      <el-table-column label="Êìç‰Ωú">
        <template #default="scope">
          <el-button type="success" size="mini">ÁºñËæë</el-button>
          <el-button
            size="mini"
            type="danger"
            @click="handleDeleteBanner(scope.$index, scope.row)"
            >Âà†Èô§
          </el-button>
        </template>
      </el-table-column>
    </el-table>
  </el-dialog>

  <!-- Êñ∞Â¢ûÊ®™ÂπÖ -->
  <el-dialog
    width="600px"
    :custom-class="customClass"
    title="Ê∑ªÂä†‰∏ªÈ°µÊ®™ÂπÖ"
    v-model="dialogAddBannerVisible"
  >
    <el-form
      label-position="right"
      label-width="80px"
      :model="formBannerData.dat"
      ref="formBannerRef"
    >
      <el-form-item label="Ê∏∏ÊàèÂêçÁß∞">
        <el-input
          placeholder="‰æãÂ¶Ç: ‰ªôÂ¢É‰º†ËØ¥RO: ÂÆàÊä§Ê∞∏ÊÅíÁöÑÁà±"
          v-model="formBannerData.dat.title"
        ></el-input>
      </el-form-item>
      <el-form-item label="Ê∏∏ÊàèÂà´Âêç">
        <el-input
          placeholder="‰æãÂ¶Ç: Ragnarok Mobile"
          v-model="formBannerData.dat.alias"
        ></el-input>
      </el-form-item>
      <el-form-item label="Ê∏∏ÊàèÂõæÊ†á">
        <el-input
          placeholder="ÂõæÊ†áÁöÑËµÑÊ∫êÂú∞ÂùÄ, Á¶ÅÊ≠¢Ë∑®ÂüüËµÑÊ∫êËÆøÈóÆ"
          v-model="formBannerData.dat.icon"
        ></el-input> </el-form-item
      >.
      <el-form-item label="Ê®™ÂπÖÂú∞ÂùÄ">
        <el-input
          placeholder="Ê®™ÂπÖÁöÑËµÑÊ∫êÂú∞ÂùÄ, ËØ∑Âãø‰ΩøÁî®ÈáçÂÆöÂêëËµÑÊ∫êÂú∞ÂùÄ"
          v-model="formBannerData.dat.cover"
        ></el-input>
      </el-form-item>
      <el-button style="width: 560px" type="primary" @click="handleAddBanner()"
        >Á´ãÂç≥ÂàõÂª∫</el-button
      >
    </el-form>
  </el-dialog>

  <!-- Êü•ÁúãÁÉ≠Èó® -->
  <el-dialog
    width="1050px"
    :custom-class="customClass"
    title="ÁÉ≠Èó®ÂàóË°®"
    v-model="dialogHotTableVisible"
  >
    <el-table :data="hotData.dat">
      <el-table-column property="title" label="ÂêçÁß∞" width="100">
      </el-table-column>
      <el-table-column property="_id" label="ID ËØÜÂà´Âè∑" width="90">
      </el-table-column>
      <el-table-column property="aid" label="Ê∏∏Êàè ID" width="100">
      </el-table-column>
      <el-table-column property="alias" label="Âà´Âêç" width="150">
      </el-table-column>
      <el-table-column property="icon" label="App ÂõæÊ†áËµÑÊ∫ê" width="150">
      </el-table-column>
      <el-table-column property="cover" label="App Ê®™ÂπÖËµÑÊ∫ê" width="150">
      </el-table-column>
      <el-table-column property="tags[0]" label="Ê†áÁ≠æ" width="50">
      </el-table-column>
      <el-table-column property="tags[1]" label="Ê†áÁ≠æ" width="50">
      </el-table-column>
      <el-table-column label="Êìç‰Ωú">
        <template #default="scope">
          <el-button type="success" size="mini">ÁºñËæë</el-button>
          <el-button
            size="mini"
            type="danger"
            @click="handleDeleteBanner(scope.$index, scope.row)"
            >Âà†Èô§
          </el-button>
        </template>
      </el-table-column>
    </el-table>
  </el-dialog>

  <el-dialog
    width="1220px"
    :custom-class="customClass"
    title="ÊúÄËøëÊõ¥Êñ∞ÂàóË°®"
    v-model="dialogUpdateTableVisible"
  >
    <el-table :data="updateData.dat">
      <el-table-column property="title" label="ÂêçÁß∞" width="100">
      </el-table-column>
      <el-table-column property="_id" label="ID ËØÜÂà´Âè∑" width="90">
      </el-table-column>
      <el-table-column property="aid" label="Ê∏∏Êàè ID" width="100">
      </el-table-column>
      <el-table-column property="alias" label="Âà´Âêç" width="150">
      </el-table-column>
      <el-table-column property="icon" label="App ÂõæÊ†áËµÑÊ∫ê" width="150">
      </el-table-column>
      <el-table-column property="cover" label="App Ê®™ÂπÖËµÑÊ∫ê" width="150">
      </el-table-column>
      <el-table-column label="Ê†áÁ≠æ" width="140">
        <template #default="scope">
          <div class="name-wrapper">
            <el-tag v-if="scope.row.new" style="margin-left: 5px" size="medium"
              >ÊúÄÊñ∞
            </el-tag>
            <el-tag
              v-if="scope.row.popular"
              style="margin-left: 5px"
              size="medium"
            >
              ‰∫∫Ê∞î
            </el-tag>
            <el-tag
              v-if="scope.row.recommend"
              style="margin-left: 5px"
              size="medium"
            >
              Êé®Ëçê
            </el-tag>
            <el-tag
              v-if="scope.row.update"
              style="margin-left: 5px"
              size="medium"
            >
              Êõ¥Êñ∞
            </el-tag>
          </div>
        </template>
      </el-table-column>
      <el-table-column property="desc" label="ÊèèËø∞" width="150">
      </el-table-column>

      <el-table-column label="Êìç‰Ωú">
        <template #default="scope">
          <el-button type="success" size="mini">ÁºñËæë</el-button>
          <el-button
            size="mini"
            type="danger"
            @click="handleDeleteBanner(scope.$index, scope.row)"
            >Âà†Èô§
          </el-button>
        </template>
      </el-table-column>
    </el-table>
  </el-dialog>
</template>

<script lang="ts">
import {
  defineComponent,
  onMounted,
  getCurrentInstance,
  ref,
  reactive,
  watch,
} from 'vue'

import { getBanner, delBanner, addBanner } from '../api/banner'
import { getHot, delHot, addHot } from '../api/hot'
import { getUpdate, delUpdate, addUpdate } from '../api/update'

import { ElNotification } from 'element-plus'
import { ops } from '../utils'

import { useStore } from 'vuex'
import { key } from '../store'

export default defineComponent({
  data() {
    return {}
  },
  setup() {
    const MeasureItems = reactive({
      dat: [
        {
          title: 'Ê®™ÂπÖÁÆ°ÁêÜ',
        },
        {
          title: 'Ê∑ªÂä†Ê®™ÂπÖ',
        },
        {
          title: 'ÁÉ≠Èó®ÁÆ°ÁêÜ',
        },
        {
          title: 'Ê∑ªÂä†ÁÉ≠Èó®',
        },
        {
          title: 'ÊúÄËøëÊõ¥Êñ∞ÁÆ°ÁêÜ',
        },
        {
          title: 'Ê∑ªÂä†Êõ¥Êñ∞ÂÜÖÂÆπ',
        },
      ],
    })

    let dialogBannerTableVisible = ref(false)
    let dialogAddBannerVisible = ref(false)
    let dialogHotTableVisible = ref(false)
    let dialogAddHotVisible = ref(false)
    let dialogUpdateTableVisible = ref(false)
    let dialogAddUpdateVisible = ref(false)

    const bannerData = reactive({ dat: [] })
    const hotData = reactive({ dat: [] })
    const updateData = reactive({ dat: [] })

    let formBannerRef = ref(null)

    function onOpen(index) {
      console.log(index)
      if (index === 0) {
        // Ëé∑Âèñbanner
        getBanner()
          .then((res) => {
            bannerData.dat = res.Data
            dialogBannerTableVisible.value = true
          })
          .catch(() => {
            ops(
              'error',
              'Ê∂àÊÅØ üòä',
              'ÁΩëÁªúÁä∂ÊÄÅÊàñÊúçÂä°Âô®ÂºÇÂ∏∏(3003)',
              customClass.value
            )
          })
      } else if (index === 1) {
        dialogAddBannerVisible.value = true
      } else if (index === 2) {
        // Ëé∑Âèñhot
        getHot()
          .then((res) => {
            hotData.dat = res.Data
            dialogHotTableVisible.value = true
          })
          .catch(() => {
            ops(
              'error',
              'Ê∂àÊÅØ üòä',
              'ÁΩëÁªúÁä∂ÊÄÅÊàñÊúçÂä°Âô®ÂºÇÂ∏∏(3003)',
              customClass.value
            )
          })
      } else if (index === 3) {
        dialogAddHotVisible.value = true
      } else if (index === 4) {
        // Ëé∑Âèñupdate
        getUpdate()
          .then((res) => {
            updateData.dat = res.Data
            dialogUpdateTableVisible.value = true
          })
          .catch(() => {
            ops(
              'error',
              'Ê∂àÊÅØ üòä',
              'ÁΩëÁªúÁä∂ÊÄÅÊàñÊúçÂä°Âô®ÂºÇÂ∏∏(3003)',
              customClass.value
            )
          })
      } else if (index === 5) {
        dialogAddUpdateVisible.value = true
      }
    }
    // get store using inject store key
    const store = useStore(key)

    // ‰∏ªÈ¢òÊõ¥Êç¢ elementui
    let customClass = ref(store.state.theme ? 'dark' : 'light')

    // ‰∏ªÈ¢òÁõëÂê¨
    watch(
      () => store.state.theme,
      (oldValue, newValue) => {
        customClass.value = store.state.theme ? 'dark' : 'light'
      }
    )

    // Âà†Èô§banner
    function handleDeleteBanner(index) {
      // console.log(bannerData.dat[index]._id)
      delBanner(bannerData.dat[index]._id)
        .then(() => {
          ops('success', 'Ê∂àÊÅØ üòä', 'Âà†Èô§ÊàêÂäü(3001)', customClass.value)
          // Âà∑Êñ∞
          bannerData.dat.splice(index, 1)
        })
        .catch(() => {
          ops('error', 'Ê∂àÊÅØ üòä', 'Âà†Èô§Â§±Ë¥•(3002)', customClass.value)
        })
    }

    // Êñ∞Â¢ûbanner
    function handleAddBanner() {
      console.log(formBannerRef.value)
      if (
        formBannerData.dat.title === '' ||
        formBannerData.dat.alias === '' ||
        formBannerData.dat.cover === '' ||
        formBannerData.dat.icon === ''
      ) {
        ops('error', 'Ê∂àÊÅØ üòä', 'Ê∑ªÂä†Â§±Ë¥•, ÂèÇÊï∞ÈîôËØØ(3003)', customClass.value)

        formBannerRef.value.resetFields()
        return
      }
      addBanner(formBannerData.dat)
        .then(() => {
          ops('success', 'Ê∂àÊÅØ üòä', 'Ê∑ªÂä†ÊàêÂäü(3001)', customClass.value)
          formBannerRef.value.resetFields()
        })
        .catch(() => {
          ops('error', 'Ê∂àÊÅØ üòä', 'Ê∑ªÂä†Â§±Ë¥•(3002)', customClass.value)
        })
    }
    const formBannerData = reactive({
      dat: {
        title: '',
        alias: '',
        cover: '',
        icon: '',
      },
    })

    return {
      handleDeleteBanner,
      customClass,
      MeasureItems,
      onOpen,
      formBannerData,
      handleAddBanner,
      formBannerRef,
      dialogBannerTableVisible,
      dialogAddBannerVisible,
      dialogHotTableVisible,
      dialogAddHotVisible,
      dialogUpdateTableVisible,
      dialogAddUpdateVisible,
      bannerData,
      hotData,
      updateData,
    }
  },
})
</script>

<style scoped>
*,
:after,
:before {
  box-sizing: border-box;
}

.measure-content {
  padding: 30px;
}
</style>

<style scoped>
.measure-item {
  height: 60px;
  width: 100%;
  /* background-color: var(--color-sb-active-row-bg); */
  background-color: var(--color-bg-sidebar);
  border-radius: 10px;
  display: flex;
  align-items: center;
  padding-left: 20px;
}

.measure-item:hover {
  background-color: var(--color-sb-active-row-bg);
}

.dvi {
  height: 1px;
  width: 100%;
  margin-top: 10px;
  margin-bottom: 10px;
  background-color: var(--color-bg-sidebar);
}

.item-title {
  font-size: 18px;
}
</style>

<!-- ÂØπËØùÊ°Ü‰∏éÂàóË°®ÁöÑ‰∏ªÈ¢òÂÆöÂà∂ -->
<style>
/* ÂØπËØùÊ°ÜÈ¢úËâ≤ */
.el-dialog {
  background-color: var(--color-bg-sidebar);
}

/* Ë°®Ê†ºÂ∫ïËâ≤ */
.el-table th,
.el-table tr {
  background-color: var(--color-bg-sidebar);
}

/* Ë°®Ê†ºÂ∫ïËâ≤Êâ©Â±ï */
.el-table,
.el-table__expanded-cell {
  background-color: var(--color-bg-sidebar);
}

/* Ë°®Ê†ºÈ°πÊÇ¨ÊµÆ */
.el-table--enable-row-hover .el-table__body tr:hover > td {
  background-color: var(--color-input-border);
}

/* Ë°®Ê†ºÂ§¥È¢úËâ≤ */
.el-table th,
.el-table tr:hover {
  background-color: var(--color-sb-active-row-bg);
}

/* Ë°®Ê†ºÈó¥ÈöîÂàÜÁ¶ª */
.el-table td,
.el-table th.is-leaf {
  border-bottom: 1px solid var(--color-separator);
}

/* Ë°®Ê†ºÂ∫ïÈÉ®ÂàÜÁ¶ª */
.el-table--border::after,
.el-table--group::after,
.el-table::before {
  background-color: var(--color-separator);
}

/* Â≠ó‰Ωì */
.el-table .cell,
.el-dialog__title {
  color: var(--color-text);
}

/* ÂºπÁ™óÊ†áÈ¢òÂ≠óÈáç */
.el-dialog__title {
  font-weight: bold;
}
</style>

<!-- Áî®Êà∑‰ø°ÊÅØÊ°ÜÂÆöÂà∂ -->
<style>
.el-alert,
.el-notification {
  display: -ms-flexbox;
  background-color: var(--color-bg-sidebar);
  border: 0px solid #ebeef5;
}

.el-notification__title {
  color: var(--color-text-highlight);
}

.el-notification__content p {
  color: var(--color-text-highlight);
}

.el-icon-close::before {
  color: var(--color-text-highlight);
}

/* ËæìÂÖ•Ê°ÜÂÆöÂà∂ */
.el-input__inner {
  background-color: var(--color-input-bg);
  border: 1px solid var(--color-input-border);
  color: var(--color-text);
}
.el-input__inner::placeholder {
  color: #585c89;
}
.el-input__inner:hover {
  border-color: var(--color-toggle-bg);
}
.el-form-item__label {
  color: var(--color-text);
}
</style>
